
#########################################################
# COMPONENTS
#########################################################

components:
  schemas:

    #########################################################
    # Notifications
    #########################################################
    BasicNotification:
      type: object
      properties:
        title: { type: string, example: "Level erreicht!" }
        body: { type: string, example: "Deine Gruppe hat Level 4 erreicht." }
        icon_url: { type: string, example: "https://example.com/icon.png" }
        image_url: { type: string, example: "https://example.com/banner.png" }
        renotify: { type: boolean, example: false }
        silent: { type: boolean, example: false }
          
    NotificationOverview:
      allOf:
        - type: object
          properties:
            id:
              type: integer
              example: 1
        - $ref: '#/components/schemas/BasicNotification'
        - type: object
          properties:
            id: { type: integer, example: 1 }
            created_at: { type: string, format: date-time }
            actions:
              type: array
              items:
                $ref: '#/components/schemas/Action'
            trigger: 
              type: object
              $ref: '#/components/schemas/TriggerExpanded'

    NotificationCreation:
      allOf:
        - $ref: '#/components/schemas/BasicNotification'
      description: Eingabeobjekt f√ºr eine neue Notification.
      properties:
        trigger_id: { type: integer, nullable: true }


    NotificationStats:
      type: object
      properties:
        notification_id: { type: integer, example: 1 }
        clicks: { type: integer, example: 12 }
        swipes: { type: integer, example: 4 }
        created_at: { type: string, format: date-time }

    #########################################################
    # Actions
    #########################################################
    BasicAction:
      type: object
      properties:
        action_type: { type: string, example: "open" }
        title: { type: string, example: "Details anzeigen" }
        icon: { type: string, example: "https://example.com/open.png" }
    
    Action:
      allOf:
        - type: object
          properties:
            id: { type: integer, example: 1 }
          -$ref: '#/components/schemas/BasicAction'


    #########################################################
    # Triggers
    #########################################################
    BasicTrigger:
      type: object
      properties:
        type: { type: string, example: "data_threshold" }
        active: { type: boolean, example: true }
        config: { type: object, description: "Trigger-spezifische JSONB-Konfiguration" }

    TriggerExpanded:
      allOf:
        - type: object
          properties:
            id: { type: integer, example: 1}
            last_triggered_at: { type: string, format: date-time, nullable: true }
        - $ref: '#/components/schemas/BasicTrigger'


    #########################################################
    # Groups & Gamification
    #########################################################

    GroupRanking:
      type: object
      properties:
        group_id: { type: integer, example: 1 }
        name: { type: string, example: "Pi01" }
        rank: { type: integer, example: 1 }
        xp: { type: integer, example: 120 }
        level: { type: integer, example: 5 }
        streak: { type: integer, example: 7 }

    GroupStats:
      type: object
      properties:
        group_id: { type: integer }
        name: { type: string }
        level: { type: integer }
        xp: { type: integer }
        streak: { type: integer }
        achievements:
          type: array
          items:
            type: integer
          example: [3, 2]

    #########################################################
    # Achievements
    #########################################################

    Achievement:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string }
        message: { type: string }
        reward_xp: { type: integer }
        image_url: { type: string }
        trigger_id: { type: integer, nullable: true }

    AchievementCreation:
      allOf:
        - $ref: '#/components/schemas/Achievement'
      required: [title, description, reward_xp]

    #########################################################
    # Errors
    #########################################################

    Error:
      type: object
      properties:
        code: { type: integer, example: 404 }
        message: { type: string, example: "Not Found" }
        details: { type: string, nullable: true }
